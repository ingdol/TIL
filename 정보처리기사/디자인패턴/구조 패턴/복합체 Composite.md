# 복합체 Composite

[복합체 패턴](https://refactoring.guru/ko/design-patterns/composite)

## 의도

- 복합체 패턴 : 객체들을 트리 구조들로 구성한 후, 이러한 구조들과 개별 객체들처럼 작업할 수 있도록 하는 구조 패턴

![Untitled](%E1%84%87%E1%85%A9%E1%86%A8%E1%84%92%E1%85%A1%E1%86%B8%E1%84%8E%E1%85%A6%20Composite%20e172a430f5bc435db3b497bd7e2d1c5f/Untitled.png)

## 문제

- 복합체 패턴은 앱의 핵심 모델이 트리로 표현될 수 있을 때만 사용
- 예를 들어 `제품들` 과 `상자들` 이라는 두 가지 유형의 객체들이 있다고 가정
  - `상자` 에는 여러 개의 `제품들` 과 여러 개의 작은 `상자들` 이 포함될 수 있음
  - 이 작은 `상자들` 은 일부 `제품들` 또는 더 작은 `상자들` 등을 담을 수 있음
- 이러한 클래스들을 사용하는 주문 시스템을 만들기로 했다고 가정
  - 주문들에는 포장이 없는 단순한 제품들과 제품들로 채워진 상자들 및 다른 상자들이 포함될 수 있음
  - 이런 주문의 총 가격을 어떻게 계산해야 할까?

![하나의 주문은 여러 제품으로 구성될 수 있는데, 이 제품들은 상자에 포함 되는 식이기에 전체 구조는 거꾸로 된 나무와 같은 모양으로 형성](%E1%84%87%E1%85%A9%E1%86%A8%E1%84%92%E1%85%A1%E1%86%B8%E1%84%8E%E1%85%A6%20Composite%20e172a430f5bc435db3b497bd7e2d1c5f/Untitled%201.png)

하나의 주문은 여러 제품으로 구성될 수 있는데, 이 제품들은 상자에 포함 되는 식이기에 전체 구조는 거꾸로 된 나무와 같은 모양으로 형성

- 직접적으로 접근 방법
  - 모든 상자를 푼 후 내부의 모든 제품을 살펴본 다음 가격의 합계를 계산
  - 현실 세계에서는 가능하나, 프로그램에서 덧셈 루프를 실행하기엔 불가능
  - 해당 클래스들에서 상자의 중첩 수준 및 기타 복잡한 세부 사항들을 알고 있어야 하기 때문

## 해결책

- 복합체 패턴은 총 가격을 계산하는 메서드를 선언하는 공통 인터페이스를 통해 `제품들` 및 `상자들` 클래스들과 작업할 것을 제안
- 해당 메서드
  - 제품의 경우, 단순히 제품 가격을 반환
  - 상자의 경우, 상자에 포함된 각 항목을 살펴보고 가격을 확인한 뒤 해당 상자의 총 가격을 반환
  - 해당 상자의 모든 내부 구성 요소의 가격이 계산될 때까지 모두 살펴봄
  - 포장 비용 같은 약간의 추가 비용도 추가

![복합체 패턴은 객체  트리의 모든 컴포넌트들에 대해 재귀적으로 행동을 실행할 수 있도록 함](%E1%84%87%E1%85%A9%E1%86%A8%E1%84%92%E1%85%A1%E1%86%B8%E1%84%8E%E1%85%A6%20Composite%20e172a430f5bc435db3b497bd7e2d1c5f/Untitled%202.png)

복합체 패턴은 객체 트리의 모든 컴포넌트들에 대해 재귀적으로 행동을 실행할 수 있도록 함

- 큰 이점
  - 더 이상 트리를 구성하는 객체들의 구상 클래스들에 대해 신경 쓸 필요 없음
  - 물건이 단순한 제품인지 내용물이 있는 상자인지 알 필요도 없음
  - 단순히 공통 인터페이스를 통해 모두 같은 방식으로 처리하면 됨
- 메서드를 호출하면 객체들 자체가 요청을 트리 아래로 전달함

## 실제상황 적용

- 군대는 계층구조로 구성
  - 여러 사단으로 구성
  - 사단은 여단의 집합
  - 여단은 소대의 집합
  - 소대는 또 분대로 나눔
  - 분대는 실제 군인들의 집합
- 명령들은 계층구조의 최상위에서 내려와 모든 병사가 자신의 수행해야 할 작업을 알게 될 때까지 계층구조의 각 하위 계층으로 전달

## 구조

![Untitled](%E1%84%87%E1%85%A9%E1%86%A8%E1%84%92%E1%85%A1%E1%86%B8%E1%84%8E%E1%85%A6%20Composite%20e172a430f5bc435db3b497bd7e2d1c5f/Untitled%203.png)

1. 컴포넌트
   - 컴포넌트 인터페이스는 트리의 단순 요소들과 복잡한 요소들 모두에 공통적인 작업을 설명
2. Leaf(잎)
   - 트리의 기본 요소이며 하위요소가 없음
   - 일반적으로 잎 컴포넌트들은 작업을 위임할 하위요소가 없어서 대부분의 실제 작업들을 수행
3. 컨테이너(일명 복합체)
   - 하위 요소들(잎 또는 기타 컨테이너)이 있는 요소
   - 컨테이너는 자녀들의 구상 클래스들을 알지 못하며, 컴포넌트 인터페이스를 통해서만 모든 하위 요소들과 함께 동작함
   - 요청을 전달받으면 컨테이는 작업을 하위 요소들에 위임하고 중간 결과들을 다음 최종 결과들을 클라이언트에 반환함
4. 클라이언트
   - 컴포넌트 인터페이스를 통해 모든 요소들과 작동함
   - 그 결과 클라이언트는 트리의 단순 요소들 또는 복잡한 요소들 모두에 대해 같은 방식으로 작업할 수 있음
