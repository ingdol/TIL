# 프록시 Proxy

[프록시 패턴](https://refactoring.guru/ko/design-patterns/proxy)

## 의도

- 프록시는 다른 객체에 대한 대체 또는 자리표시자를 제공할 수 있는 구조 디자인 패턴
  - 원래 객체에 대한 접근을 제어하므로, 우리의 요청이 원래 객체에 전달되기 전 또는 후에 무언가를 수행할 수 있도록 함

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%A8%E1%84%89%E1%85%B5%20Proxy%200ac1042c74604fb883b3482810892517/Untitled.png)

## 문제

- 객체에 대한 접근을 제한하는 이유는 무엇일까?
- 방대한 양의 시스템 자원을 소비하는 거대한 객체가 있다고 가정하면
  - 이 객체는 필요할 때가 있기는 하지만 항상 필요한 것은 아님

![데이터베이스 쿼리들은 정말 느릴 수 있음](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%A8%E1%84%89%E1%85%B5%20Proxy%200ac1042c74604fb883b3482810892517/Untitled%201.png)

데이터베이스 쿼리들은 정말 느릴 수 있음

- 실제로 필요할 때만 이 객체를 만들어서 지연된 초기화를 구현할 수 있음
  - 그러면 객체의 모든 클라이언트들은 어떤 지연된 초기화 코드를 실행해야 하는데, 아마도 많은 코드 중복을 초래할 것임
- 이는 코드를 객체의 클래스에 직접 넣을 수 있겠지만 가능한 일은 아님
  - 그 클래스가 폐쇄된 타사 라이브러리의 일부일 수 있음

## 해결책

- 프록시 패턴은 원래 서비스 객체와 같은 인터페이스로 새 프록시 클래스를 생성하라고 제안
  - 프록시 객체를 원래 객체의 모든 클라이언트들에 전달하도록 앱을 업데이트할 수 있음
  - 클라이언트로부터 요청을 받으면 이 프록시는 실제 서비스 객체를 생성하고 모든 작업을 이 객체에 위임함

![프록시는 데이터베이스 객체로 자신을 변장함. 프록시는 지연된 초기화 및 결괏값 캐싱을 클라이언트와 실제 데이터베이스 객체가 알지 못하는 상태에서 처리할 수 잇음](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%A8%E1%84%89%E1%85%B5%20Proxy%200ac1042c74604fb883b3482810892517/Untitled%202.png)

프록시는 데이터베이스 객체로 자신을 변장함. 프록시는 지연된 초기화 및 결괏값 캐싱을 클라이언트와 실제 데이터베이스 객체가 알지 못하는 상태에서 처리할 수 잇음

- 클래스의 메인 로직 이전이나 이후에 무언가를 실행해야 하는 경우 프록시는 해당 클래스를 변경하지 않고도 무언가를 수행할 수 있도록 함
  - 프록시는 원래 클래스와 같은 인터페이스를 구현하므로 실제 서비스 객체를 기대하는 모든 클라이언트에 전달될 수 있음

## 실제상황 적용

![신용 카드는 현금과 마찬가지로 결제에 사용할 수 있음](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%A8%E1%84%89%E1%85%B5%20Proxy%200ac1042c74604fb883b3482810892517/Untitled%203.png)

신용 카드는 현금과 마찬가지로 결제에 사용할 수 있음

- 신용 카드는 은행 계좌의 프록시이며, 은행 계좌는 현금의 프록시임
  - 둘 다 같은 인터페이스를 구현하며 둘 다 결제에 사용될 수 있음
  - 신용카드는 현금을 안 갖고 다녀도 되며, 계좌는 도난 방지에 장점이 있음

## 구조

![Untitled](%E1%84%91%E1%85%B3%E1%84%85%E1%85%A9%E1%86%A8%E1%84%89%E1%85%B5%20Proxy%200ac1042c74604fb883b3482810892517/Untitled%204.png)

1. 서비스 인터페이스
   - 서비스의 인터페이스를 선언함
   - 프록시가 서비스 객체로 위장할 수 있으려면 이 인터페이스를 따라야 함
2. 서비스
   - 어떤 유용한 비즈니스 로직을 제공하는 클래스
3. 프록시
   - 프록시 클래스에는 서비스 객체를 가리키는 참조 필드가 있음
   - 프록시가 요청의 처리(예 : 초기화 지연, 로깅, 액세스 제어, 캐싱 등) 완료하면, 그 후 처리된 요청을 서비스 객체에 전달함
   - 일반적으로 프록시들은 서비스 객체들의 전체 수명 주기를 관리함
4. 클라이언트
   - 같은 인터페이스를 통해 서비스들 및 프록시들과 함께 작동해야 함
   - 서비스 객체를 기대하는 모든 코드에 프록시를 전달할 수 있기 때문
